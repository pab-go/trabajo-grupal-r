"0","# Paso 1: Calcular el censo único por elección"
"0","censo_por_eleccion <- election_data |> "
"0","  group_by(fecha, id_mun) |>  # Agrupar por elección y municipio"
"0","  slice(1)|> "
"0","  ungroup() |> "
"0","  group_by(fecha) |>  # Agrupar nuevamente por elección"
"0","  summarise(censo_total = sum(censo, na.rm = TRUE), .groups = ""drop"")  # Sumar el censo por elección"
"0",""
"0","# Paso 2: Agrupar votos por grupo y calcular el porcentaje"
"0","resultados_porcentajes2 <- election_data |> "
"0","  mutate("
"0","    Grupo = case_when("
"0","      str_detect(siglas, ""VOX|PP"") ~ ""DERECHAS"","
"0","      str_detect(siglas, ""PSOE|UP|MP"") ~ ""IZQUIERDAS"","
"0","      str_detect(siglas, ""PNV|BNG|ERC|BILDU|CONVERGÈNCIA I UNIÓ"") ~ ""NACIONALISTA/REGIONALISTA"","
"0","      str_detect(siglas, ""CS"") ~ ""CENTRO"","
"0","      TRUE ~ ""OTROS"""
"0","    )"
"0","  ) |> "
"0","  group_by(fecha, Grupo) |> "
"0","  summarise("
"0","    n_votos = sum(votos, na.rm = TRUE),   # Total de votos del grupo por elección"
"0","    .groups = ""drop"""
"0","  ) |> "
"0","  left_join(censo_por_eleccion, by = ""fecha"") |>  # Añadir el censo total por elección"
"0","  mutate("
"0","    porcentaje = (n_votos / censo_total) * 100  # Calcular porcentaje sobre el censo total"
"0","  )"
"0",""
"0",""
"0","BROWN <- ""#AD8C97"""
"0","YELLOW <- ""yellow"""
"0","GREEN <- ""#2FC1D3"""
"0","BLUE <- ""#076FA1"""
"0","GREY <- ""#C7C9CB"""
"0","GREY_DARKER <- ""#5C5B5D"""
"0","RED <- ""#E3120B"""
"0",""
"0","resultados_porcentajes2 <- resultados_porcentajes2 |> "
"0","  mutate(Grupo = factor(Grupo, levels = c(""OTROS"",""IZQUIERDAS"",  ""NACIONALISTA/REGIONALISTA"", ""CENTRO"",""DERECHAS"")))"
"0",""

"0"," "
"0",""
"0","# Paso 1: Calcular el censo √∫nico por elecci√≥n"
"0","censo_por_eleccion <- election_data |> "
"0","  group_by(fecha, id_mun) |>  # Agrupar por elecci√≥n y municipio"
"0","  slice(1)|> "
"0","  ungroup() |> "
"0","  group_by(fecha) |>  # Agrupar nuevamente por elecci√≥n"
"0","  summarise(censo_total = sum(censo, na.rm = TRUE), .groups = ""drop"")  # Sumar el censo por elecci√≥n"
"0",""
"0","# Paso 2: Agrupar votos por grupo y calcular el porcentaje"
"0","resultados_porcentajes <- election_data |> "
"0","  mutate("
"0","    Grupo = case_when("
"0","      str_detect(siglas, ""PSOE|PP"") ~ ""PARTIDO TRADICIONAL"","
"0","      str_detect(siglas, ""CS|UP|MP|VOX"") ~ ""PARTIDO NUEVO"","
"0","      str_detect(siglas, ""PNV|BNG|ERC|BILDU|CONVERG√àNCIA I UNI√ì"") ~ ""NACIONALISTA/REGIONALISTA"","
"0","      TRUE ~ ""OTROS"""
"0","    )"
"0","  ) |> "
"0","  group_by(fecha, Grupo) |> "
"0","  summarise("
"0","    n_votos = sum(votos, na.rm = TRUE),   # Total de votos del grupo por elecci√≥n"
"0","    .groups = ""drop"""
"0","  ) |> "
"0","  left_join(censo_por_eleccion, by = ""fecha"") |>  # A√±adir el censo total por elecci√≥n"
"0","  mutate("
"0","    porcentaje = (n_votos / censo_total) * 100  # Calcular porcentaje sobre el censo total"
"0","  )"
"0",""
"0","BROWN <- ""#AD8C97"""
"0","BROWN_DARKER <- ""#7d3a46"""
"0","GREEN <- ""#2FC1D3"""
"0","BLUE <- ""#076FA1"""
"0","GREY <- ""#C7C9CB"""
"0","GREY_DARKER <- ""#5C5B5D"""
"0","RED <- ""#E3120B"""
"0",""
"0","plt1 <- ggplot(resultados_porcentajes, aes(fecha, porcentaje)) +"
"0","  geom_line(aes(color = Grupo,size= 1.2)) +"
"0","  geom_point("
"0","    aes(fill = Grupo), "
"0","    size = 5, "
"0","    pch = 21, # Type of point that allows us to have both color (border) and fill."
"0","    color = ""white"", "
"0","    stroke = 1 # The width of the border, i.e. stroke."
"0","  ) +"
"0"," scale_color_manual(values = c(BLUE, GREEN, BROWN,GREY)) +"
"0","  scale_fill_manual(values = c(BLUE, GREEN, BROWN,GREY)) + "
"0","   theme_minimal()+"
"0","  theme(legend.position = ""right"")+"
"0","  scale_x_date("
"0","    breaks = unique(resultados_porcentajes$fecha),   # Usar solo las fechas espec√≠ficas"
"0","    date_labels = ""%Y""           # Mostrar solo el a√±o en las etiquetas"
"0","  ) +"
"0","  scale_y_continuous("
"0","    breaks = seq(0, 100, by = 5),  # Intervalos de 5 unidades en el eje Y"
"0","    limits = c(0, 100)  )+"
"0","  theme("
"0","    # Set background color to white"
"0","    panel.background = element_rect(fill = ""white""),"
"0","    # Remove all grid lines"
"0","    panel.grid = element_blank(),"
"0","    # But add grid lines for the vertical axis, customizing color and size "
"0","    panel.grid.major.y = element_line(color = ""#A8BAC4"", size = 0.3),"
"0","    # Remove tick marks on the vertical axis by setting their length to 0"
"0","    axis.ticks.length.y = unit(0, ""mm""), "
"0","    # But keep tick marks on horizontal axis"
"0","    axis.ticks.length.x = unit(2, ""mm""),"
"0","    # Remove the title for both axes"
"0","    axis.title = element_text(size = 11, face = ""bold""), # Estilo de t√≠tulos de los ejes,"
"0","    # Only the bottom line of the vertical axis is painted in black"
"0","    axis.line.x.bottom = element_line(color = ""#A8BAC4""),"
"0","    # Remove labels from the vertical axis"
"0","    axis.text.y = element_text(family = ""Econ Sans Cnd"", size = 12),"
"0","    # But customize labels for the horizontal axis"
"0","    axis.text.x = element_text(family = ""Econ Sans Cnd"", size = 12,angle = 45)"
"0","  )+"
"0","    guides(size = ""none"")+"
"0","  labs("
"0","    title = ""Evoluci√≥n del porcentaje de votos por grupo"","
"0","    x = ""Fecha de la elecci√≥n"","
"0","    y = ""Porcentaje de votos (%)"""
"0","  )"
"0",""
"0","# A√±adir t√≠tulo estilizado"
"0","plt1 <- plt1 +"
"0","  labs("
"0","    title = ""Evoluci√≥n de grupos pol√≠ticos: % de votos"""
"0","  ) + "
"0","  theme("
"0","    margin = margin(20, 20, 20, 0),"
"0","    plot.title = element_markdown("
"0","      family = ""Econ Sans Cnd"", "
"0","      size = 15"
"0","    )"
"0","  )"
"0",""
"0","# Mostrar el gr√°fico"
"0","plt1"
"2","Aviso en plot_theme(plot) :"
"2","
 "
"2"," [38;5;252mThe `margin` theme element is not defined in the element hierarchy.[39m
"
"2","Aviso en grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"
"2","Aviso en grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y,  :"
"2","
 "
"2"," font family not found in Windows font database
"

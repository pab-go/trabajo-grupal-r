margin = margin(20, 0, 10, 0)
plot.title = element_markdown(
library(ggplot2)
library(ggtext) # Para usar `element_markdown`
library(ggnewscale) # Para usar `new_scale_color`
# Paso 1: Calcular el censo único por elección
censo_por_eleccion <- election_data |>
group_by(fecha, id_mun) |>  # Agrupar por elección y municipio
slice(1)|>
ungroup() |>
group_by(fecha) |>  # Agrupar nuevamente por elección
summarise(censo_total = sum(participacion, na.rm = TRUE), .groups = "drop")  # Sumar el censo por elección
# Paso 2: Agrupar votos por grupo y calcular el porcentaje
resultados_porcentajes <- election_data |>
mutate(
Grupo = case_when(
str_detect(siglas, "PSOE|PP") ~ "PARTIDO TRADICIONAL",
str_detect(siglas, "CS|UP|MP|VOX") ~ "PARTIDO NUEVO",
str_detect(siglas, "PNV|BNG|ERC|BILDU|CONVERGÈNCIA I UNIÓ") ~ "NACIONALISTA/REGIONALISTA",
TRUE ~ "OTROS"
)
) |>
group_by(fecha, Grupo) |>
summarise(
n_votos = sum(votos, na.rm = TRUE),   # Total de votos del grupo por elección
.groups = "drop"
) |>
left_join(censo_por_eleccion, by = "fecha") |>  # Añadir el censo total por elección
mutate(
porcentaje = (n_votos / censo_total) * 100  # Calcular porcentaje sobre el censo total
)
BROWN <- "#AD8C97"
BROWN_DARKER <- "#7d3a46"
GREEN <- "#2FC1D3"
BLUE <- "#076FA1"
GREY <- "#C7C9CB"
GREY_DARKER <- "#5C5B5D"
RED <- "#E3120B"
plt1 <- ggplot(resultados_porcentajes, aes(fecha, porcentaje)) +
geom_line(aes(color = Grupo,size= 1.5)) +
geom_point(
aes(fill = Grupo),
size = 5,
pch = 21, # Type of point that allows us to have both color (border) and fill.
color = "white",
stroke = 1 # The width of the border, i.e. stroke.
) +
scale_color_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
scale_fill_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
theme(legend.position = "bottom")+
scale_x_date(
breaks = unique(resultados_porcentajes$fecha),   # Usar solo las fechas específicas
date_labels = "%Y"           # Mostrar solo el año en las etiquetas
) +
scale_y_continuous(
breaks = seq(0, 100, by = 5),  # Intervalos de 5 unidades en el eje Y
limits = c(0, 100)  )+
theme(
# Set background color to white
panel.background = element_rect(fill = "white"),
# Remove all grid lines
panel.grid = element_blank(),
# But add grid lines for the vertical axis, customizing color and size
panel.grid.major.y = element_line(color = "#A8BAC4", size = 0.3),
# Remove tick marks on the vertical axis by setting their length to 0
axis.ticks.length.y = unit(0, "mm"),
# But keep tick marks on horizontal axis
axis.ticks.length.x = unit(2, "mm"),
# Remove the title for both axes
axis.title = element_blank(),
# Only the bottom line of the vertical axis is painted in black
axis.line.x.bottom = element_line(color = "black"),
# Remove labels from the vertical axis
axis.text.y = element_blank(),
# But customize labels for the horizontal axis
axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)
)+
theme_minimal() +
theme(
axis.title = element_text(size = 11, face = "bold"), # Estilo de títulos de los ejes
axis.text = element_text(size = 12)
) +
guides(size = "none")+
labs(
title = "Evolución del porcentaje de votos por grupo",
x = "Fecha de la elección",
y = "Porcentaje de votos (%)"
)
# Añadir título estilizado
plt1 <- plt1 +
labs(
title = "Evolución de grupos políticos: % de votos"
) +
theme(
margin = margin(20, 0, 10, 0),
plot.title = element_markdown(
family = "Econ Sans Cnd",
size = 20
)
)
# Mostrar el gráfico
plt1
library(ggplot2)
library(ggtext) # Para usar `element_markdown`
library(ggnewscale) # Para usar `new_scale_color`
# Paso 1: Calcular el censo único por elección
censo_por_eleccion <- election_data |>
group_by(fecha, id_mun) |>  # Agrupar por elección y municipio
slice(1)|>
ungroup() |>
group_by(fecha) |>  # Agrupar nuevamente por elección
summarise(censo_total = sum(participacion, na.rm = TRUE), .groups = "drop")  # Sumar el censo por elección
# Paso 2: Agrupar votos por grupo y calcular el porcentaje
resultados_porcentajes <- election_data |>
mutate(
Grupo = case_when(
str_detect(siglas, "PSOE|PP") ~ "PARTIDO TRADICIONAL",
str_detect(siglas, "CS|UP|MP|VOX") ~ "PARTIDO NUEVO",
str_detect(siglas, "PNV|BNG|ERC|BILDU|CONVERGÈNCIA I UNIÓ") ~ "NACIONALISTA/REGIONALISTA",
TRUE ~ "OTROS"
)
) |>
group_by(fecha, Grupo) |>
summarise(
n_votos = sum(votos, na.rm = TRUE),   # Total de votos del grupo por elección
.groups = "drop"
) |>
left_join(censo_por_eleccion, by = "fecha") |>  # Añadir el censo total por elección
mutate(
porcentaje = (n_votos / censo_total) * 100  # Calcular porcentaje sobre el censo total
)
BROWN <- "#AD8C97"
BROWN_DARKER <- "#7d3a46"
GREEN <- "#2FC1D3"
BLUE <- "#076FA1"
GREY <- "#C7C9CB"
GREY_DARKER <- "#5C5B5D"
RED <- "#E3120B"
plt1 <- ggplot(resultados_porcentajes, aes(fecha, porcentaje)) +
geom_line(aes(color = Grupo,size= 1.5)) +
geom_point(
aes(fill = Grupo),
size = 5,
pch = 21, # Type of point that allows us to have both color (border) and fill.
color = "white",
stroke = 1 # The width of the border, i.e. stroke.
) +
scale_color_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
scale_fill_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
theme(legend.position = "bottom")+
scale_x_date(
breaks = unique(resultados_porcentajes$fecha),   # Usar solo las fechas específicas
date_labels = "%Y"           # Mostrar solo el año en las etiquetas
) +
scale_y_continuous(
breaks = seq(0, 100, by = 5),  # Intervalos de 5 unidades en el eje Y
limits = c(0, 100)  )+
theme(
# Set background color to white
panel.background = element_rect(fill = "white"),
# Remove all grid lines
panel.grid = element_blank(),
# But add grid lines for the vertical axis, customizing color and size
panel.grid.major.y = element_line(color = "#A8BAC4", size = 0.3),
# Remove tick marks on the vertical axis by setting their length to 0
axis.ticks.length.y = unit(0, "mm"),
# But keep tick marks on horizontal axis
axis.ticks.length.x = unit(2, "mm"),
# Remove the title for both axes
axis.title = element_blank(),
# Only the bottom line of the vertical axis is painted in black
axis.line.x.bottom = element_line(color = "black"),
# Remove labels from the vertical axis
axis.text.y = element_blank(),
# But customize labels for the horizontal axis
axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)
)+
theme_minimal() +
theme(
axis.title = element_text(size = 11, face = "bold"), # Estilo de títulos de los ejes
axis.text = element_text(size = 12)
) +
guides(size = "none")+
labs(
title = "Evolución del porcentaje de votos por grupo",
x = "Fecha de la elección",
y = "Porcentaje de votos (%)"
)
# Añadir título estilizado
plt1 <- plt1 +
labs(
title = "Evolución de grupos políticos: % de votos"
) +
theme(
margin = margin(20, 10, 10, 0),
plot.title = element_markdown(
family = "Econ Sans Cnd",
size = 20
)
)
# Mostrar el gráfico
plt1
library(ggplot2)
library(ggtext) # Para usar `element_markdown`
library(ggnewscale) # Para usar `new_scale_color`
# Paso 1: Calcular el censo único por elección
censo_por_eleccion <- election_data |>
group_by(fecha, id_mun) |>  # Agrupar por elección y municipio
slice(1)|>
ungroup() |>
group_by(fecha) |>  # Agrupar nuevamente por elección
summarise(censo_total = sum(participacion, na.rm = TRUE), .groups = "drop")  # Sumar el censo por elección
# Paso 2: Agrupar votos por grupo y calcular el porcentaje
resultados_porcentajes <- election_data |>
mutate(
Grupo = case_when(
str_detect(siglas, "PSOE|PP") ~ "PARTIDO TRADICIONAL",
str_detect(siglas, "CS|UP|MP|VOX") ~ "PARTIDO NUEVO",
str_detect(siglas, "PNV|BNG|ERC|BILDU|CONVERGÈNCIA I UNIÓ") ~ "NACIONALISTA/REGIONALISTA",
TRUE ~ "OTROS"
)
) |>
group_by(fecha, Grupo) |>
summarise(
n_votos = sum(votos, na.rm = TRUE),   # Total de votos del grupo por elección
.groups = "drop"
) |>
left_join(censo_por_eleccion, by = "fecha") |>  # Añadir el censo total por elección
mutate(
porcentaje = (n_votos / censo_total) * 100  # Calcular porcentaje sobre el censo total
)
BROWN <- "#AD8C97"
BROWN_DARKER <- "#7d3a46"
GREEN <- "#2FC1D3"
BLUE <- "#076FA1"
GREY <- "#C7C9CB"
GREY_DARKER <- "#5C5B5D"
RED <- "#E3120B"
plt1 <- ggplot(resultados_porcentajes, aes(fecha, porcentaje)) +
geom_line(aes(color = Grupo,size= 1.5)) +
geom_point(
aes(fill = Grupo),
size = 5,
pch = 21, # Type of point that allows us to have both color (border) and fill.
color = "white",
stroke = 1 # The width of the border, i.e. stroke.
) +
scale_color_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
scale_fill_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
theme(legend.position = "bottom")+
scale_x_date(
breaks = unique(resultados_porcentajes$fecha),   # Usar solo las fechas específicas
date_labels = "%Y"           # Mostrar solo el año en las etiquetas
) +
scale_y_continuous(
breaks = seq(0, 100, by = 5),  # Intervalos de 5 unidades en el eje Y
limits = c(0, 100)  )+
theme(
# Set background color to white
panel.background = element_rect(fill = "white"),
# Remove all grid lines
panel.grid = element_blank(),
# But add grid lines for the vertical axis, customizing color and size
panel.grid.major.y = element_line(color = "#A8BAC4", size = 0.3),
# Remove tick marks on the vertical axis by setting their length to 0
axis.ticks.length.y = unit(0, "mm"),
# But keep tick marks on horizontal axis
axis.ticks.length.x = unit(2, "mm"),
# Remove the title for both axes
axis.title = element_blank(),
# Only the bottom line of the vertical axis is painted in black
axis.line.x.bottom = element_line(color = "black"),
# Remove labels from the vertical axis
axis.text.y = element_blank(),
# But customize labels for the horizontal axis
axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)
)+
theme_minimal() +
theme(
axis.title = element_text(size = 11, face = "bold"), # Estilo de títulos de los ejes
axis.text = element_text(size = 12)
) +
guides(size = "none")+
labs(
title = "Evolución del porcentaje de votos por grupo",
x = "Fecha de la elección",
y = "Porcentaje de votos (%)"
)
# Añadir título estilizado
plt1 <- plt1 +
labs(
title = "Evolución de grupos políticos: % de votos"
) +
theme(
margin = margin(20, 10, 20, 0),
plot.title = element_markdown(
family = "Econ Sans Cnd",
size = 25
)
)
# Mostrar el gráfico
plt1
library(ggplot2)
library(ggtext) # Para usar `element_markdown`
library(ggnewscale) # Para usar `new_scale_color`
# Paso 1: Calcular el censo único por elección
censo_por_eleccion <- election_data |>
group_by(fecha, id_mun) |>  # Agrupar por elección y municipio
slice(1)|>
ungroup() |>
group_by(fecha) |>  # Agrupar nuevamente por elección
summarise(censo_total = sum(participacion, na.rm = TRUE), .groups = "drop")  # Sumar el censo por elección
# Paso 2: Agrupar votos por grupo y calcular el porcentaje
resultados_porcentajes <- election_data |>
mutate(
Grupo = case_when(
str_detect(siglas, "PSOE|PP") ~ "PARTIDO TRADICIONAL",
str_detect(siglas, "CS|UP|MP|VOX") ~ "PARTIDO NUEVO",
str_detect(siglas, "PNV|BNG|ERC|BILDU|CONVERGÈNCIA I UNIÓ") ~ "NACIONALISTA/REGIONALISTA",
TRUE ~ "OTROS"
)
) |>
group_by(fecha, Grupo) |>
summarise(
n_votos = sum(votos, na.rm = TRUE),   # Total de votos del grupo por elección
.groups = "drop"
) |>
left_join(censo_por_eleccion, by = "fecha") |>  # Añadir el censo total por elección
mutate(
porcentaje = (n_votos / censo_total) * 100  # Calcular porcentaje sobre el censo total
)
BROWN <- "#AD8C97"
BROWN_DARKER <- "#7d3a46"
GREEN <- "#2FC1D3"
BLUE <- "#076FA1"
GREY <- "#C7C9CB"
GREY_DARKER <- "#5C5B5D"
RED <- "#E3120B"
plt1 <- ggplot(resultados_porcentajes, aes(fecha, porcentaje)) +
geom_line(aes(color = Grupo,size= 1.5)) +
geom_point(
aes(fill = Grupo),
size = 5,
pch = 21, # Type of point that allows us to have both color (border) and fill.
color = "white",
stroke = 1 # The width of the border, i.e. stroke.
) +
scale_color_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
scale_fill_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
theme(legend.position = "bottom")+
scale_x_date(
breaks = unique(resultados_porcentajes$fecha),   # Usar solo las fechas específicas
date_labels = "%Y"           # Mostrar solo el año en las etiquetas
) +
scale_y_continuous(
breaks = seq(0, 100, by = 5),  # Intervalos de 5 unidades en el eje Y
limits = c(0, 100)  )+
theme(
# Set background color to white
panel.background = element_rect(fill = "white"),
# Remove all grid lines
panel.grid = element_blank(),
# But add grid lines for the vertical axis, customizing color and size
panel.grid.major.y = element_line(color = "#A8BAC4", size = 0.3),
# Remove tick marks on the vertical axis by setting their length to 0
axis.ticks.length.y = unit(0, "mm"),
# But keep tick marks on horizontal axis
axis.ticks.length.x = unit(2, "mm"),
# Remove the title for both axes
axis.title = element_blank(),
# Only the bottom line of the vertical axis is painted in black
axis.line.x.bottom = element_line(color = "black"),
# Remove labels from the vertical axis
axis.text.y = element_blank(),
# But customize labels for the horizontal axis
axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)
)+
theme_minimal() +
theme(
axis.title = element_text(size = 11, face = "bold"), # Estilo de títulos de los ejes
axis.text = element_text(size = 12)
) +
guides(size = "none")+
labs(
title = "Evolución del porcentaje de votos por grupo",
x = "Fecha de la elección",
y = "Porcentaje de votos (%)"
)
# Añadir título estilizado
plt1 <- plt1 +
labs(
title = "Evolución de grupos políticos: % de votos"
) +
theme(
margin = margin(20, 10, 20, 0),
plot.title = element_markdown(
family = "Econ Sans Cnd",
size = 22
)
)
# Mostrar el gráfico
plt1
# Agrupar por pollster y sumar el error absoluto
pollster_error <- elecciones_encuestas |>
group_by(id_pollster, pollster) |>
summarize(total_error = sum(error_absoluto, na.rm = TRUE), .groups = "drop") |> ungroup()
# Encontrar el pollster con el menor error
pollster_min_error <- pollster_error |>
filter(total_error == min(total_error))
# Encontrar el pollster con el mayor error
pollster_max_error <- pollster_error |>
filter(total_error == max(total_error))
library(ggplot2)
library(ggtext) # Para usar `element_markdown`
library(ggnewscale) # Para usar `new_scale_color`
# Paso 1: Calcular el censo único por elección
censo_por_eleccion <- election_data |>
group_by(fecha, id_mun) |>  # Agrupar por elección y municipio
slice(1)|>
ungroup() |>
group_by(fecha) |>  # Agrupar nuevamente por elección
summarise(censo_total = sum(participacion, na.rm = TRUE), .groups = "drop")  # Sumar el censo por elección
# Paso 2: Agrupar votos por grupo y calcular el porcentaje
resultados_porcentajes <- election_data |>
mutate(
Grupo = case_when(
str_detect(siglas, "PSOE|PP") ~ "PARTIDO TRADICIONAL",
str_detect(siglas, "CS|UP|MP|VOX") ~ "PARTIDO NUEVO",
str_detect(siglas, "PNV|BNG|ERC|BILDU|CONVERGÈNCIA I UNIÓ") ~ "NACIONALISTA/REGIONALISTA",
TRUE ~ "OTROS"
)
) |>
group_by(fecha, Grupo) |>
summarise(
n_votos = sum(votos, na.rm = TRUE),   # Total de votos del grupo por elección
.groups = "drop"
) |>
left_join(censo_por_eleccion, by = "fecha") |>  # Añadir el censo total por elección
mutate(
porcentaje = (n_votos / censo_total) * 100  # Calcular porcentaje sobre el censo total
)
BROWN <- "#AD8C97"
BROWN_DARKER <- "#7d3a46"
GREEN <- "#2FC1D3"
BLUE <- "#076FA1"
GREY <- "#C7C9CB"
GREY_DARKER <- "#5C5B5D"
RED <- "#E3120B"
plt1 <- ggplot(resultados_porcentajes, aes(fecha, porcentaje)) +
geom_line(aes(color = Grupo,size= 1.5)) +
geom_point(
aes(fill = Grupo),
size = 5,
pch = 21, # Type of point that allows us to have both color (border) and fill.
color = "white",
stroke = 1 # The width of the border, i.e. stroke.
) +
scale_color_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
scale_fill_manual(values = c(BLUE, GREEN, BROWN,GREY)) +
theme(legend.position = "bottom")+
scale_x_date(
breaks = unique(resultados_porcentajes$fecha),   # Usar solo las fechas específicas
date_labels = "%Y"           # Mostrar solo el año en las etiquetas
) +
scale_y_continuous(
breaks = seq(0, 100, by = 5),  # Intervalos de 5 unidades en el eje Y
limits = c(0, 100)  )+
theme(
# Set background color to white
panel.background = element_rect(fill = "white"),
# Remove all grid lines
panel.grid = element_blank(),
# But add grid lines for the vertical axis, customizing color and size
panel.grid.major.y = element_line(color = "#A8BAC4", size = 0.3),
# Remove tick marks on the vertical axis by setting their length to 0
axis.ticks.length.y = unit(0, "mm"),
# But keep tick marks on horizontal axis
axis.ticks.length.x = unit(2, "mm"),
# Remove the title for both axes
axis.title = element_blank(),
# Only the bottom line of the vertical axis is painted in black
axis.line.x.bottom = element_line(color = "black"),
# Remove labels from the vertical axis
axis.text.y = element_blank(),
# But customize labels for the horizontal axis
axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)
)+
theme_minimal() +
theme(
axis.title = element_text(size = 11, face = "bold"), # Estilo de títulos de los ejes
axis.text = element_text(size = 12)
) +
guides(size = "none")+
labs(
title = "Evolución del porcentaje de votos por grupo",
x = "Fecha de la elección",
y = "Porcentaje de votos (%)"
)
# Añadir título estilizado
plt1 <- plt1 +
labs(
title = "Evolución de grupos políticos: % de votos"
) +
theme(
margin = margin(20, 20, 20, 0),
plot.title = element_markdown(
family = "Econ Sans Cnd",
size = 20
)
)
# Mostrar el gráfico
plt1
